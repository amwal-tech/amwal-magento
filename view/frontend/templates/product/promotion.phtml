<?php
use Magento\Catalog\Block\Product\ProductList\Item\Block;
use Magento\Framework\Escaper;
use Magento\Framework\View\Element\Template;
/**
 * @var Escaper $escaper
 * @var Template|Block $block
 */
?>

<?php if ($block->isPromotionsActive()): ?>
    <script type="module" src="https://cdn.jsdelivr.net/npm/amwal-checkout-button@latest/dist/checkout/checkout.esm.js"></script>
    <script>
        (function() {
            // Define the widget configuration
            const widgetConfig = {
                installmentsCount: <?= (int) $block->getInstallmentsCount() ?>,
                price: <?= (float) $block->getPrice() ?>,
                currency: "SAR",
                locale: document.documentElement.lang || 'en'
            };
            // Initialize when DOM is ready
            require(['jquery'], function ($) {
                try {
                    const widget = document.getElementById('amwal-widget');
                    if (widget) {
                        widget.config = widgetConfig;
                    }
                } catch (error) {
                    console.error('Amwal Promotion: Error initializing widget', error);
                }
            });
        })();
    </script>
    <style>
        <?php if ($block->isOnShoppingCartPage()): ?>
        .amwal-promo {
            min-width: 270px !important;
        }
        <?php endif; ?>
    </style>
    <amwal-widget
        id="amwal-widget"
        show-popular-badge="true"
        show-monthly-payment="true"
        show-green-border="true"
        <?php if (!$block->isOnShoppingCartPage()): ?>
        style="width: 200px;"
        show-social-proof="true"
        social-proof-text="‚≠ê Trusted by 50,000+ happy customers"
        <?php endif; ?>>
    </amwal-widget>
<?php endif; ?>
